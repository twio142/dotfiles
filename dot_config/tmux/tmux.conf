unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

set-hook -ga session-created "if '[ -n \"\$SSH_CONNECTION\" ]' 'set prefix2 C-b; bind C-b send-prefix -2'"

# windows
unbind n
bind n if-shell -F "#{>:#{session_windows},1}" next-window "neww -c '$HOME'"
unbind c
bind c neww -c "$HOME"
bind Tab last-window

# split panes
unbind '"'
bind - splitw -v -l 35% -c "#{pane_current_path}"
unbind %
bind | splitw -h -c "#{pane_current_path}"

# switch panes
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -n C-h if -F "#{==:#{pane_current_command},nvim}" { send C-h } {
  if -F "#{pane_at_left}#{window_zoomed_flag}" "send C-h" "selectp -L"
}
bind -n C-j if -F "#{==:#{pane_current_command},nvim}" { send C-j } {
  if -F "#{pane_at_bottom}#{window_zoomed_flag}" "send C-j" "selectp -D"
}
bind -n C-k if -F "#{==:#{pane_current_command},nvim}" { send C-k } {
  if -F "#{pane_at_top}#{window_zoomed_flag}" "send C-k" "selectp -U"
}
bind -n C-l if -F "#{==:#{pane_current_command},nvim}" { send C-l } {
  if -F "#{pane_at_right}#{window_zoomed_flag}" "send C-l" "selectp -R"
}
bind ` last-pane

# resize panes
bind -r C-Left resize-pane -L 8
bind -r C-Down resize-pane -D 8
bind -r C-Up resize-pane -U 8
bind -r C-Right resize-pane -R 8

bind x kill-pane # skip confirmation to kill pane
# open new window and open config file in vim
unbind "\~"

set -g default-command "zsh"
set -ga terminal-overrides ",*-256color:Tc"

set -g display-time 2000 # 2 seconds for display-time
set -g mouse on # enable mouse support
set -g renumber-windows on # renumber windows when a window is closed
set -g base-index 1 # start window numbering at 1
set -g pane-base-index 1 # start pane numbering at 1
set -g set-titles on
set -g set-titles-string "#{pane_current_command} ▸ #{b:pane_current_path}" # set title format
set -g escape-time 10 # faster key response
set -g status-justify left # left justify status bar
setw -g monitor-activity off # monitor for activity
setw -g monitor-bell on # monitor for bell
set -g visual-activity on
set -g visual-bell off
setw -g window-status-bell-style default
setw -g window-status-activity-style default

# copy mode
set -s set-clipboard on # enable system clipboard
setw -g mode-keys vi # vi key bindings in copy mode
bind v copy-mode # enter copy mode
bind C-v copy-mode
bind -n M-v copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection # start selection with v
bind -T copy-mode-vi y send-keys -X copy-selection # copy selection with y
bind -T copy-mode-vi Y send-keys 'v$y' # copy to end of line
bind -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel \; paste-buffer # paste selection
bind -T copy-mode-vi H send -X back-to-indentation
bind -T copy-mode-vi L send -X end-of-line
bind -T copy-mode-vi O send-keys -X copy-pipe-and-cancel "xargs -I _ open '_'"
bind -T copy-mode-vi i send-keys -X cancel
bind -T copy-mode-vi M-Up send-keys -X search-backward "^❯ "
bind -T copy-mode-vi M-Down send-keys -X search-forward "^❯ "
bind -T copy-mode-vi C-h select-pane -L
bind -T copy-mode-vi C-j select-pane -D
bind -T copy-mode-vi C-k select-pane -U
bind -T copy-mode-vi C-l select-pane -R

# command alias
set -g command-alias[10] EF="neww -n config 'nvim $XDG_CONFIG_HOME/tmux/tmux.conf'"
set -g command-alias[11] ER="source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display-message 'Config reloaded'"
set -g command-alias[12] tmux-man="run 'man tmux'"
set -g command-alias[13] man="splitw -v man"
set -g command-alias[14] toggle-status="if-shell 'tmux show -q status | grep -q on' 'set status off' 'set status on'"
set -g command-alias[15] yank-buffer="run 'tmux show-buffer | yank'"

bind M-h tmux-man
bind C-m man
bind C-r ER

set -g @plugin 'tmux-plugins/tpm' # tmux plugin manager
set -g @plugin 'tmux-plugins/tmux-sensible' # sensible defaults
# prefix I   install
# prefix U   update
# prefix M-u remove

set -g @plugin 'catppuccin/tmux'
# latte, frappe, macchiato or mocha
set -g @catppuccin_flavor "latte"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_status_background "none"
set -g @catppuccin_status_module_bg_color "#{@thm_bg}"
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_host_icon "#{?#{==:#(uname),Darwin}, ,#{?#{==:#(uname),Linux}, ,󰒋 }}"
set -g @catppuccin_host_text " #(whoami)@#h"
set -g @catppuccin_session_color "#{?client_prefix,#{E:@thm_flamingo},#{E:@thm_teal}}"
set -g window-status-format "#[bg=#{@thm_surface_1},fg=#{@thm_fg}] #{b:pane_current_path} | #I "
set -g window-status-current-format "#[bg=#{@thm_lavender},fg=#{@thm_crust}] #{b:pane_current_path} | #I "
set -g status-left "#{E:@catppuccin_status_session}"
set -g status-right "#{E:@catppuccin_status_host}"

run "$XDG_CONFIG_HOME/tmux/plugins/tpm/tpm"
