#!/bin/zsh
# verify SHA checksum of the file

sum=$(pbpaste)

case "$1" in
  -h|--help)
    echo "Usage: $(basename "$0") <file>"
    echo
    echo "Verifies the SHA checksum of the specified file."
    exit 0
    ;;
  *)
    [ -e "$1" ] || { echo "Usage: $(basename "$0") <file>" >&2; exit 1; }
    file="$1"
    ;;
esac

alg=${sum%%:*}
hash=${sum#*:}

if ! [[ -n "$alg" && -n "$hash" && "$alg" =~ ^sha[0-9]+$ ]]; then
  echo "Invalid checksum format. Expected format: <algorithm>:<checksum> (e.g., sha256:abcdef...)" >&2
  echo "Please copy the checksum to your clipboard." >&2
  exit 1
fi

tmpfile=$(mktemp)
trap 'rm -f "$tmpfile"' EXIT

echo "$hash  ${file:a}" > "$tmpfile"
shasum -a "${alg#sha}" -c "$tmpfile"
