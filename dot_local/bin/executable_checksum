#!/bin/zsh
# verify SHA checksum for the file

sum=$(pbpaste)

file="$1"
if [ ! -e "$file" ]; then
  echo "Usage: $0 <file>"
  exit 1
fi

alg=${sum%%:*}
hash=${sum#*:}

if ! [[ -n "$alg" && -n "$hash" && "$alg" =~ ^sha[0-9]+$ ]]; then
  echo "Invalid checksum format. Expected format: <algorithm>:<checksum> (e.g., sha256:abcdef...)" >&2
  echo "Please copy the checksum to your clipboard." >&2
  exit 1
fi

tmpfile=$(mktemp)
trap 'rm -f "$tmpfile"' EXIT

echo "$hash  ${file:a}" > "$tmpfile"
shasum -a "${alg#sha}" -c "$tmpfile"
