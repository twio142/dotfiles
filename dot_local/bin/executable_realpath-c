#!/bin/zsh
# realpath, but case sensitive

if [[ "$1" == "-h" || "$1" == "--help" ]]; then
  echo "Usage: $(basename "$0") <path>..."
  echo
  echo "Resolves and prints the real, case-sensitive path for each given file or directory."
  echo "Useful on case-insensitive file systems to find the canonical path name."
  exit 0
fi

[ -e "${1:a}" ] || { echo "File not found" ; exit 1 }

for o in "${@:a}"; do
  i=2
  while true; do
    local d=$(eval "echo \${o:h${i}}")
    (( i++ ))
    local t=$(eval "echo \${o:h${i}:t}")
    local e=$(fd -d 1 -H --glob "$t" "$d" | sd '\/$' '')
    [ ${#e} -eq ${#o} ] && { echo $e; break; }
    o=$e${o:${#e}}
  done
done
