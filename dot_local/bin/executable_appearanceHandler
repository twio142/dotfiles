#!/bin/zsh

export PATH=$HOME/.local/bin:/opt/homebrew/opt/ruby/bin:$PATH:/opt/homebrew/bin
XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-~/.config}

case $1 in
  light) mode=$1 flavor=latte env=0 color=white;;
  dark)  mode=$1 flavor=mocha env=1 color=black;;
  -h|--help)
    echo "Usage: $(basename "$0") [option]"
    echo
    echo "Sets the appearance mode for various applications."
    echo
    echo "Options:"
    echo "  light         Set appearance to light mode."
    echo "  dark          Set appearance to dark mode."
    echo "  -h, --help    Display this help message and exit."
    exit 0
    ;;
  *)     exit 1 ;;
esac

# Nvim
nvr --serverlist 2>/dev/null | grep nvim | while read -r server; do
  timeout 2s nvr --servername "$server" --nostart -c "set background=$mode" 2>/dev/null || true
done

# Tmux
tmux set -g @DARK $env && {
  tmux set -g @catppuccin_flavor "$flavor"
  tmux set -g @fingers-backdrop-style "fg=$color,bright"
  tmux run ${XDG_CONFIG_HOME}/tmux/plugins/tmux/catppuccin.tmux
  tmux run ${XDG_CONFIG_HOME}/tmux/plugins/tmux-fingers/tmux-fingers.tmux &
}

# yazi theme
DIR=$XDG_CONFIG_HOME/yazi/flavors
if [ -d $DIR ]; then
  rm $DIR/catppuccin.yazi &> /dev/null
  ln -s $DIR/catppuccin-$flavor.yazi $DIR/catppuccin.yazi
fi

# lsd theme
DIR=$XDG_CONFIG_HOME/lsd
if [ -f $DIR/${mode}.yaml ]; then 
  ln -sf $DIR/${mode}.yaml $DIR/colors.yaml
fi

# Btop theme
FILE=/opt/homebrew/share/btop/themes/gruvbox_${mode}.theme
if [ -f $FILE ]; then
  ln -sf $FILE $XDG_CONFIG_HOME/btop/themes/gruvbox.theme
fi

# Hammerspoon
hs -A -c "ConsoleDM()"
