#!/bin/zsh

export PATH=$HOME/.local/bin:/opt/homebrew/opt/ruby/bin:$PATH:/opt/homebrew/bin
XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-~/.config}

case $1 in
  light) mode=$1 flavor=latte color=white;;
  dark)  mode=$1 flavor=mocha color=black;;
  *)     exit 1 ;;
esac

# Nvim
nvr --serverlist | while read -r server; do
  nvr --servername $server --nostart -c "set background=$mode"
done

# Tmux
tmux set -g @catppuccin_flavor "$flavor"
tmux run ${XDG_CONFIG_HOME}/tmux/plugins/catppuccin-tmux/catppuccin.tmux
tmux set -g @fingers-backdrop-style "fg=$color,bright"
tmux run ${XDG_CONFIG_HOME}/tmux/plugins/tmux-fingers/tmux-fingers.tmux &

# yazi theme
DIR=$XDG_CONFIG_HOME/yazi
if [ -d $DIR ]; then
  echo "[flavor]" > $DIR/theme.toml
  echo "light = \"catppuccin-$flavor\"" >> $DIR/theme.toml
  echo "dark = \"catppuccin-$flavor\"" >> $DIR/theme.toml
fi

# Alacritty theme
DIR=${XDG_CONFIG_HOME}/alacritty
if [ -f $DIR/$mode.toml ]; then
  ln -sf $DIR/$mode.toml $DIR/colors.toml
  touch $DIR/alacritty.toml
fi

# Hammerspoon
hs -A -c "ConsoleDM()"

# lsd theme
DIR=$XDG_CONFIG_HOME/lsd
if [ -f $DIR/${mode}.yaml ]; then 
  ln -sf $DIR/${mode}.yaml $DIR/colors.yaml
fi

# Btop theme
FILE=$XDG_CONFIG_HOME/btop/btop.conf
if [ -f $FILE ]; then
  sd '(^color_theme = .*)light|dark' "\${1}$mode" $FILE
fi
